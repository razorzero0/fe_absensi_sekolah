<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin - Manajemen Siswa</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
    />

    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #f8f9fa;
      }
      /* --- Layout Desktop Fix --- */
      .sidebar {
        min-height: 100vh;
        background: linear-gradient(180deg, #28a745, #1e7e34); /* Hijau */
        width: 280px;
        flex-shrink: 0;
      }

      @media (min-width: 768px) {
        .sidebar {
          position: static !important;
        }
        .content-wrapper {
          margin-left: 0 !important;
        }
      }

      .sidebar .nav-link {
        color: #ffffff;
        padding: 15px 20px;
        transition: background-color 0.3s;
        border-radius: 8px;
        margin-bottom: 5px;
      }
      .sidebar .nav-link:hover,
      .sidebar .nav-link.active {
        background-color: rgba(255, 255, 255, 0.2);
      }
      .sidebar-header {
        padding: 20px;
        color: white;
        font-size: 1.5rem;
        font-weight: 700;
      }
      .form-card {
        border-radius: 12px;
      }

      .offcanvas-md {
        width: 280px;
      }
    </style>
  </head>
  <body>
    <div class="d-flex">
      <nav
        class="sidebar offcanvas-md offcanvas-start d-flex flex-column p-3"
        tabindex="-1"
        id="sidebarMenu"
        aria-labelledby="sidebarMenuLabel"
      >
        <div class="offcanvas-header d-md-none">
          <h5 class="offcanvas-title text-white" id="sidebarMenuLabel">
            ADMIN Absensi
          </h5>
          <button
            type="button"
            class="btn-close btn-close-white"
            data-bs-dismiss="offcanvas"
            data-bs-target="#sidebarMenu"
            aria-label="Close"
          ></button>
        </div>

        <div
          class="offcanvas-body d-md-flex flex-column p-0 pt-lg-3 overflow-y-auto"
        >
          <div class="sidebar-header text-center mb-4 d-none d-md-block">
            ADMIN Absensi
          </div>
          <nav class="nav flex-column flex-grow-1">
            <a class="nav-link" href="admin_dashboard.html">
              <i class="fas fa-home me-2"></i> Dashboard
            </a>
            <a class="nav-link active" href="#">
              <i class="fas fa-users me-2"></i> Manajemen Siswa
            </a>
            <a class="nav-link" href="admin_manajemen_absensi.html">
              <i class="fas fa-calendar-check me-2"></i> Manajemen Absensi
            </a>
            <a class="nav-link mt-auto" href="admin_login.html">
              <i class="fas fa-sign-out-alt me-2"></i> Logout
            </a>
          </nav>
        </div>
      </nav>

      <main class="content-wrapper flex-grow-1 p-3 p-md-4">
        <div class="d-md-none mb-3 d-flex align-items-center">
          <button
            class="btn btn-success"
            type="button"
            data-bs-toggle="offcanvas"
            data-bs-target="#sidebarMenu"
            aria-controls="sidebarMenu"
          >
            <i class="fas fa-bars"></i> Menu
          </button>
          <span class="h4 ms-3 text-success">Manajemen Siswa</span>
        </div>

        <h1 class="mb-4 d-none d-md-block">Manajemen Data Siswa</h1>

        <div class="d-flex justify-content-between align-items-center mb-4">
          <h4 class="mb-0 text-success">Daftar Siswa Aktif</h4>
          <button
            class="btn btn-success rounded-3"
            data-bs-toggle="modal"
            data-bs-target="#siswaFormModal"
            data-mode="add"
            id="btnAddSiswa"
          >
            <i class="fas fa-plus-circle me-2"></i> Tambah Siswa Baru
          </button>
        </div>

        <div class="card shadow-sm">
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-striped table-hover">
                <thead>
                  <tr>
                    <th>NIS</th>
                    <th>Nama</th>
                    <th>Kelas</th>
                    <th>L/P</th>
                    <th>Wali</th>
                    <th>Aksi</th>
                  </tr>
                </thead>
                <tbody id="studentTableBody"></tbody>
              </table>
            </div>
            <p class="text-muted small mt-3">
              Total <span id="totalStudents">0</span> Siswa ditemukan.
            </p>
          </div>
        </div>
      </main>
    </div>

    <div
      class="modal fade"
      id="siswaFormModal"
      tabindex="-1"
      aria-labelledby="siswaFormModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg">
        <div class="modal-content rounded-4">
          <div class="modal-header bg-success text-white" id="modalHeader">
            <h5 class="modal-title" id="siswaFormModalLabel">
              <i class="fas fa-plus-circle me-2"></i> Tambah Siswa Baru
            </h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form id="siswaForm">
              <input type="hidden" id="originalNis" />
              <div class="row g-3">
                <div class="col-md-6">
                  <label for="nis" class="form-label"
                    >NIS (Nomor Induk Siswa)
                    <span class="text-danger">*</span></label
                  >
                  <input
                    type="text"
                    class="form-control rounded-3"
                    id="nis"
                    required
                    placeholder="Contoh: 123460"
                    pattern="[0-9]{6,10}"
                    title="NIS harus berupa angka antara 6 hingga 10 digit."
                  />
                  <div class="form-text">NIS harus unik.</div>
                </div>
                <div class="col-md-6">
                  <label for="namaLengkap" class="form-label"
                    >Nama Lengkap <span class="text-danger">*</span></label
                  >
                  <input
                    type="text"
                    class="form-control rounded-3"
                    id="namaLengkap"
                    required
                  />
                </div>
                <div class="col-md-6">
                  <label for="kelas" class="form-label"
                    >Kelas <span class="text-danger">*</span></label
                  >
                  <select class="form-select rounded-3" id="kelas" required>
                    <option value="" selected disabled>Pilih Kelas...</option>
                    <option>X IPA 1</option>
                    <option>XI IPS 2</option>
                    <option>XII BAHASA 3</option>
                    <option>X IPS 1</option>
                    <option>XI IPA 2</option>
                    <option>XII IPA 3</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label for="jenisKelamin" class="form-label"
                    >Jenis Kelamin <span class="text-danger">*</span></label
                  >
                  <select
                    class="form-select rounded-3"
                    id="jenisKelamin"
                    required
                  >
                    <option value="" selected disabled>
                      Pilih Jenis Kelamin...
                    </option>
                    <option value="Laki-laki">Laki-laki</option>
                    <option value="Perempuan">Perempuan</option>
                  </select>
                </div>
                <div class="col-12">
                  <h5 class="mt-4 mb-2 text-success">Data Wali/Orang Tua</h5>
                </div>
                <div class="col-md-12">
                  <label for="wali" class="form-label"
                    >Nama Wali/Orang Tua
                    <span class="text-danger">*</span></label
                  >
                  <input
                    type="text"
                    class="form-control rounded-3"
                    id="wali"
                    required
                  />
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary rounded-3"
              data-bs-dismiss="modal"
            >
              Batal
            </button>
            <button
              type="submit"
              form="siswaForm"
              class="btn btn-success rounded-3"
              id="btnSubmitSiswaForm"
            >
              <i class="fas fa-plus me-1"></i> Tambah Siswa
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="successModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content rounded-4 border-success border-2">
          <div class="modal-header bg-success text-white">
            <h5 class="modal-title">
              <i class="fas fa-check-circle me-2"></i> Sukses!
            </h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <p id="successMessage"></p>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-success rounded-3"
              data-bs-dismiss="modal"
            >
              OK
            </button>
          </div>
        </div>
      </div>
    </div>

    <div
      class="modal fade"
      id="deleteModal"
      tabindex="-1"
      aria-labelledby="deleteModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content rounded-4 border-danger border-2">
          <div class="modal-header bg-danger text-white">
            <h5 class="modal-title" id="deleteModalLabel">
              <i class="fas fa-exclamation-triangle me-2"></i> Konfirmasi Hapus
            </h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <p>
              Apakah Anda yakin ingin menghapus data siswa **<span
                id="deleteSiswaName"
              ></span
              >** (NIS: <span id="deleteSiswaNis"></span>)?
            </p>
            <p class="text-danger fw-bold">
              Tindakan ini tidak bisa dibatalkan.
            </p>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary rounded-3"
              data-bs-dismiss="modal"
            >
              Batal
            </button>
            <button
              type="button"
              class="btn btn-danger rounded-3"
              id="confirmDelete"
              data-nis=""
            >
              Ya, Hapus
            </button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Simulasi Data Siswa
      let students = [
        {
          nis: "123456",
          nama: "Budi Santoso",
          kelas: "X IPA 1",
          jk: "Laki-laki",
          wali: "Bpk. Aji",
        },
        {
          nis: "123457",
          nama: "Siti Fatimah",
          kelas: "XI IPS 2",
          jk: "Perempuan",
          wali: "Ibu Dian",
        },
      ];

      // Variabel Global untuk DOM dan Modal
      const studentTableBody = document.getElementById("studentTableBody");
      const totalStudentsEl = document.getElementById("totalStudents");
      const successMessageEl = document.getElementById("successMessage");
      const siswaFormModal = new bootstrap.Modal(
        document.getElementById("siswaFormModal")
      );
      const successModal = new bootstrap.Modal(
        document.getElementById("successModal")
      );
      const deleteModal = new bootstrap.Modal(
        document.getElementById("deleteModal")
      );
      const siswaForm = document.getElementById("siswaForm");
      const btnSubmitSiswaForm = document.getElementById("btnSubmitSiswaForm");
      const modalHeaderEl = document.getElementById("modalHeader");
      const siswaFormModalLabel = document.getElementById(
        "siswaFormModalLabel"
      );

      // Elemen Form
      const nisInput = document.getElementById("nis");
      const namaLengkapInput = document.getElementById("namaLengkap");
      const kelasInput = document.getElementById("kelas");
      const jenisKelaminInput = document.getElementById("jenisKelamin");
      const waliInput = document.getElementById("wali");
      const originalNisInput = document.getElementById("originalNis");

      // --- FUNGSI UTAMA ---

      /**
       * Memperbarui tampilan tabel siswa.
       */
      function renderTable() {
        studentTableBody.innerHTML = "";
        students.forEach((student) => {
          const jkInitial = student.jk.charAt(0); // L atau P

          const row = studentTableBody.insertRow();
          row.innerHTML = `
            <td>${student.nis}</td>
            <td>${student.nama}</td>
            <td>${student.kelas}</td>
            <td>${jkInitial}</td>
            <td>${student.wali}</td>
            <td>
              <button 
                class="btn btn-sm btn-info text-white me-1 btn-edit" 
                title="Edit"
                data-nis="${student.nis}"
              >
                <i class="fas fa-edit"></i>
              </button>
              <button 
                class="btn btn-sm btn-danger btn-delete" 
                title="Hapus"
                data-nis="${student.nis}"
                data-nama="${student.nama}"
              >
                <i class="fas fa-trash"></i>
              </button>
            </td>
          `;
        });
        totalStudentsEl.textContent = students.length;
        attachTableListeners();
      }

      /**
       * Memasang event listener untuk tombol Edit dan Hapus
       */
      function attachTableListeners() {
        // Edit Listener
        document.querySelectorAll(".btn-edit").forEach((button) => {
          button.addEventListener("click", function () {
            const nisToEdit = this.getAttribute("data-nis");
            openSiswaFormModal("edit", nisToEdit);
          });
        });

        // Delete Listener
        document.querySelectorAll(".btn-delete").forEach((button) => {
          button.addEventListener("click", function () {
            const nisToDelete = this.getAttribute("data-nis");
            const namaToDelete = this.getAttribute("data-nama");
            openDeleteModal(nisToDelete, namaToDelete);
          });
        });
      }

      /**
       * Mengkonfigurasi dan menampilkan modal Tambah/Edit.
       * @param {string} mode 'add' atau 'edit'
       * @param {string} nisToEdit NIS siswa yang akan diedit (hanya relevan jika mode='edit')
       */
      function openSiswaFormModal(mode, nisToEdit = null) {
        siswaForm.reset();
        originalNisInput.value = "";

        if (mode === "add") {
          // Mode Tambah
          siswaFormModalLabel.textContent = "Tambah Siswa Baru";
          btnSubmitSiswaForm.innerHTML =
            '<i class="fas fa-plus me-1"></i> Tambah Siswa';
          btnSubmitSiswaForm.classList.replace("btn-primary", "btn-success");
          modalHeaderEl.classList.replace("bg-primary", "bg-success");
          nisInput.disabled = false;
        } else if (mode === "edit" && nisToEdit) {
          // Mode Edit
          const student = students.find((s) => s.nis === nisToEdit);
          if (!student) return;

          siswaFormModalLabel.textContent = `Edit Data Siswa: ${student.nama}`;
          btnSubmitSiswaForm.innerHTML =
            '<i class="fas fa-save me-1"></i> Simpan Perubahan';
          btnSubmitSiswaForm.classList.replace("btn-success", "btn-primary");
          modalHeaderEl.classList.replace("bg-success", "bg-primary");

          // Isi Form
          originalNisInput.value = student.nis; // Simpan NIS lama
          nisInput.value = student.nis;
          namaLengkapInput.value = student.nama;
          kelasInput.value = student.kelas;
          jenisKelaminInput.value = student.jk;
          waliInput.value = student.wali;

          nisInput.disabled = true; // NIS tidak boleh diubah saat edit
        }
        siswaFormModal.show();
      }

      /**
       * Mengkonfigurasi dan menampilkan modal Hapus.
       * @param {string} nis NIS siswa yang akan dihapus
       * @param {string} nama Nama siswa
       */
      function openDeleteModal(nis, nama) {
        document.getElementById("deleteSiswaName").textContent = nama;
        document.getElementById("deleteSiswaNis").textContent = nis;
        document.getElementById("confirmDelete").setAttribute("data-nis", nis);
        deleteModal.show();
      }

      // --- EVENT LISTENERS ---

      // 1. Pemicu Modal Tambah
      document
        .getElementById("btnAddSiswa")
        .addEventListener("click", function () {
          openSiswaFormModal("add");
        });

      // 2. Handler Submit Form Tambah/Edit
      siswaForm.addEventListener("submit", function (e) {
        e.preventDefault();

        const nis = nisInput.value;
        const nama = namaLengkapInput.value;
        const kelas = kelasInput.value;
        const jenisKelamin = jenisKelaminInput.value;
        const wali = waliInput.value;
        const originalNis = originalNisInput.value;

        let message;

        if (originalNis) {
          // LOGIKA EDIT (UPDATE)
          const index = students.findIndex((s) => s.nis === originalNis);
          if (index !== -1) {
            students[index] = { nis, nama, kelas, jk: jenisKelamin, wali };
            message = `Data siswa **${nama} (${nis})** berhasil diperbarui.`;
          } else {
            alert("Error: Data siswa tidak ditemukan untuk diperbarui.");
            return;
          }
        } else {
          // LOGIKA TAMBAH (CREATE)
          if (students.some((s) => s.nis === nis)) {
            alert("NIS sudah ada. Mohon gunakan NIS yang unik.");
            return;
          }
          const newStudent = { nis, nama, kelas, jk: jenisKelamin, wali };
          students.push(newStudent);
          message = `Data siswa **${nama} (${nis})** berhasil ditambahkan.`;
        }

        siswaFormModal.hide();
        renderTable();

        successMessageEl.innerHTML = message;
        successModal.show();
      });

      // 3. Handler Konfirmasi Hapus
      document
        .getElementById("confirmDelete")
        .addEventListener("click", function () {
          const nisToDelete = this.getAttribute("data-nis");
          const studentName =
            document.getElementById("deleteSiswaName").textContent;

          // LOGIKA HAPUS (DELETE)
          const initialLength = students.length;
          students = students.filter((s) => s.nis !== nisToDelete);

          if (students.length < initialLength) {
            // Berhasil Dihapus
            deleteModal.hide();
            renderTable();

            successMessageEl.innerHTML = `Data siswa **${studentName}** (NIS: ${nisToDelete}) telah berhasil dihapus.`;
            successModal.show();
          } else {
            alert("Error: Data siswa tidak ditemukan.");
            deleteModal.hide();
          }
        });

      // Panggil fungsi render untuk inisialisasi tabel saat halaman dimuat
      renderTable();
    </script>
  </body>
</html>
