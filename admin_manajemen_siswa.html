<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin - Manajemen Siswa</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.datatables.net/2.3.4/css/dataTables.dataTables.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
    />

    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #f8f9fa;
      }

      /* --- Layout Desktop Fix --- */
      .sidebar {
        min-height: 100vh;
        background: linear-gradient(180deg, #28a745, #1e7e34); /* Hijau */
        width: 280px;
        flex-shrink: 0;
      }

      /* Menonaktifkan fixed position di desktop dan memastikan layout sejajar */
      @media (min-width: 768px) {
        .sidebar {
          position: static !important;
        }
        .content-wrapper {
          margin-left: 0 !important;
        }
      }

      /* Styling Sidebar */
      .sidebar .nav-link {
        color: #ffffff;
        padding: 15px 20px;
        transition: background-color 0.3s;
        border-radius: 8px;
        margin-bottom: 5px;
      }
      .sidebar .nav-link:hover,
      .sidebar .nav-link.active {
        background-color: rgba(255, 255, 255, 0.2);
      }
      .sidebar-header {
        padding: 20px;
        color: white;
        font-size: 1.5rem;
        font-weight: 700;
      }
      .card-table {
        border-radius: 12px;
      }

      /* Offcanvas untuk Mobile */
      .offcanvas-md {
        width: 280px;
      }

      div.dt-container select.dt-input {
        margin-right: 5px;
      }
    </style>
  </head>
  <body>
    <div class="d-flex">
      <nav
        class="sidebar offcanvas-md offcanvas-start d-flex flex-column p-3"
        tabindex="-1"
        id="sidebarMenu"
        aria-labelledby="sidebarMenuLabel"
      >
        <div class="offcanvas-header d-md-none">
          <h5 class="offcanvas-title text-white" id="sidebarMenuLabel">
            ADMIN Absensi
          </h5>
          <button
            type="button"
            class="btn-close btn-close-white"
            data-bs-dismiss="offcanvas"
            data-bs-target="#sidebarMenu"
            aria-label="Close"
          ></button>
        </div>

        <div
          class="offcanvas-body d-md-flex flex-column p-0 pt-lg-3 overflow-y-auto"
        >
          <div class="sidebar-header text-center mb-4 d-none d-md-block">
            ADMIN Absensi
          </div>
          <nav class="nav flex-column flex-grow-1">
            <a class="nav-link" href="admin_dashboard.html">
              <i class="fas fa-home me-2"></i> Dashboard
            </a>
            <a class="nav-link active" href="admin_manajemen_siswa.html">
              <i class="fas fa-users me-2"></i> Manajemen Siswa
            </a>
            <a class="nav-link" href="admin_manajemen_absensi.html">
              <i class="fas fa-calendar-check me-2"></i> Manajemen Absensi
            </a>
            <a class="nav-link mt-auto" href="admin_login.html">
              <i class="fas fa-sign-out-alt me-2"></i> Logout
            </a>
          </nav>
        </div>
      </nav>

      <main class="content-wrapper flex-grow-1 p-3 p-md-4">
        <div class="d-md-none mb-3 d-flex align-items-center">
          <button
            class="btn btn-success"
            type="button"
            data-bs-toggle="offcanvas"
            data-bs-target="#sidebarMenu"
            aria-controls="sidebarMenu"
          >
            <i class="fas fa-bars"></i> Menu
          </button>
          <span class="h4 ms-3 text-success">Manajemen Siswa</span>
        </div>

        <h1 class="mb-4 d-none d-md-block">Manajemen Siswa</h1>

        <div class="card card-table shadow-sm">
          <div
            class="card-header bg-success text-white d-flex justify-content-between align-items-center"
          >
            <span class="fw-bold"
              ><i class="fas fa-table me-2"></i> Daftar Siswa</span
            >
            <a
              href="#"
              class="btn btn-light btn-sm rounded-3"
              data-bs-toggle="modal"
              data-bs-target="#tambahSiswaModal"
            >
              <i class="fas fa-plus me-1"></i> Tambah Siswa Baru
            </a>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table
                id="siswaTable"
                class="table table-striped table-hover"
                style="width: 100%"
              >
                <thead>
                  <tr>
                    <th>NIS</th>
                    <th>Nama Siswa</th>
                    <th>Kelas</th>
                    <th>Wali Murid</th>
                    <th>Aksi</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>
      </main>
    </div>

    <div
      class="modal fade"
      id="tambahSiswaModal"
      tabindex="-1"
      aria-labelledby="tambahSiswaModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content rounded-4">
          <div class="modal-header bg-success text-white">
            <h5 class="modal-title" id="tambahSiswaModalLabel">
              <i class="fas fa-plus me-2"></i> Tambah Siswa Baru
            </h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <p>Form penambahan siswa berada di sini.</p>
            <div class="alert alert-info">
              Ini adalah simulasi. Anda dapat mengarahkan tombol "Tambah Siswa
              Baru" ke halaman lain (`admin_tambah_siswa.html`) atau menggunakan
              modal seperti ini.
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary rounded-3"
              data-bs-dismiss="modal"
            >
              Tutup
            </button>
            <a href="admin_tambah_siswa.html" class="btn btn-success rounded-3">
              Tambah Siswa Baru
            </a>
          </div>
        </div>
      </div>
    </div>

    <div
      class="modal fade"
      id="editSiswaModal"
      tabindex="-1"
      aria-labelledby="editSiswaModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content rounded-4">
          <div class="modal-header bg-warning text-white">
            <h5 class="modal-title" id="editSiswaModalLabel">
              <i class="fas fa-edit me-2"></i> Edit Data Siswa
            </h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <form id="editSiswaForm">
            <div class="modal-body">
              <input type="hidden" id="edit-siswa-id" />
              <div class="row g-3">
                <div class="col-md-6">
                  <label for="edit-nis" class="form-label">NIS</label>
                  <input
                    type="text"
                    class="form-control rounded-3"
                    id="edit-nis"
                    required
                    readonly
                  />
                </div>
                <div class="col-md-6">
                  <label for="edit-nama" class="form-label">Nama Lengkap</label>
                  <input
                    type="text"
                    class="form-control rounded-3"
                    id="edit-nama"
                    required
                  />
                </div>
                <div class="col-md-6">
                  <label for="edit-kelas" class="form-label">Kelas</label>
                  <select
                    class="form-select rounded-3"
                    id="edit-kelas"
                    required
                  >
                    <option>X IPA 1</option>
                    <option>XI IPS 2</option>
                    <option>XII BAHASA 3</option>
                    <option>X IPS 1</option>
                    <option>XI IPA 2</option>
                    <option>XII IPA 3</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label for="edit-wali" class="form-label"
                    >Nama Wali Murid</label
                  >
                  <input
                    type="text"
                    class="form-control rounded-3"
                    id="edit-wali"
                    required
                  />
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary rounded-3"
                data-bs-dismiss="modal"
              >
                Batal
              </button>
              <button
                type="submit"
                class="btn btn-warning text-white rounded-3"
              >
                <i class="fas fa-save me-1"></i> Simpan Perubahan
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script
      type="text/javascript"
      charset="utf8"
      src="https://cdn.datatables.net/2.3.4/js/dataTables.js"
    ></script>

    <script>
      $(document).ready(function () {
        // Data Dummy Siswa
        let siswaData = [
          {
            id: 1,
            nis: "123456",
            nama: "Ahmad Budi Santoso",
            kelas: "XII IPA 1",
            wali: "Bapak Heru Santoso",
          },
          {
            id: 2,
            nis: "123457",
            nama: "Siti Aminah",
            kelas: "XI IPS 2",
            wali: "Ibu Fatimah",
          },
          {
            id: 3,
            nis: "123458",
            nama: "Joko Susanto",
            kelas: "X IPA 1",
            wali: "Bapak Bambang",
          },
          {
            id: 4,
            nis: "123459",
            nama: "Dewi Lestari",
            kelas: "XII BAHASA 3",
            wali: "Ibu Kartika",
          },
          // Tambahkan data lainnya agar tabel lebih panjang
          {
            id: 5,
            nis: "123460",
            nama: "Rio Firmansyah",
            kelas: "X IPS 1",
            wali: "Bapak Sugiarto",
          },
          {
            id: 6,
            nis: "123461",
            nama: "Nadia Putri",
            kelas: "XI IPA 2",
            wali: "Ibu Rina",
          },
          {
            id: 7,
            nis: "123462",
            nama: "Chandra Wijaya",
            kelas: "XII IPA 3",
            wali: "Bapak Chandra Senior",
          },
          {
            id: 8,
            nis: "123463",
            nama: "Fitriani",
            kelas: "X IPA 1",
            wali: "Ibu Eka",
          },
          {
            id: 9,
            nis: "123464",
            nama: "Herman Ali",
            kelas: "XI IPS 2",
            wali: "Bapak Ahmad",
          },
          {
            id: 10,
            nis: "123465",
            nama: "Indah Kusuma",
            kelas: "XII IPA 1",
            wali: "Ibu Maria",
          },
        ];

        // Fungsi untuk membuat baris aksi
        function createActionButtons(data) {
          return `
                    <button class="btn btn-sm btn-warning rounded-3 me-2 btn-edit" data-id="${data.id}" data-bs-toggle="modal" data-bs-target="#editSiswaModal" title="Edit">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm btn-danger rounded-3 btn-delete" data-id="${data.id}" title="Hapus">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                `;
        }

        // Inisialisasi DataTables
        let table = $("#siswaTable").DataTable({
          // Siapkan data DataTables dari array dummy
          data: siswaData.map((s) => [
            s.nis,
            s.nama,
            s.kelas,
            s.wali,
            createActionButtons(s),
          ]),
          columns: [
            { title: "NIS" },
            { title: "Nama Siswa" },
            { title: "Kelas" },
            { title: "Wali Murid" },
            { title: "Aksi", orderable: false, searchable: false },
          ],
          // Menggunakan bahasa Indonesia untuk DataTables

          responsive: true,
        });

        // Logika Edit Siswa
        $("#siswaTable tbody").on("click", ".btn-edit", function () {
          const siswaId = $(this).data("id");
          // Cari data siswa berdasarkan ID
          const siswa = siswaData.find((s) => s.id === siswaId);

          if (siswa) {
            $("#edit-siswa-id").val(siswa.id);
            $("#edit-nis").val(siswa.nis);
            $("#edit-nama").val(siswa.nama);
            $("#edit-kelas").val(siswa.kelas);
            $("#edit-wali").val(siswa.wali);
          }
        });

        $("#editSiswaForm").on("submit", function (e) {
          e.preventDefault();
          const id = parseInt($("#edit-siswa-id").val());
          const nama = $("#edit-nama").val();
          const kelas = $("#edit-kelas").val();
          const wali = $("#edit-wali").val();

          // Cari index baris di DataTables berdasarkan ID siswa
          const index = siswaData.findIndex((s) => s.id === id);

          if (index !== -1) {
            // 1. Update dummy data
            siswaData[index].nama = nama;
            siswaData[index].kelas = kelas;
            siswaData[index].wali = wali;

            // 2. Update DataTables row
            table
              .row(index)
              .data([
                siswaData[index].nis,
                siswaData[index].nama,
                siswaData[index].kelas,
                siswaData[index].wali,
                createActionButtons(siswaData[index]),
              ])
              .draw(false);
          }

          // Tutup modal
          bootstrap.Modal.getInstance(
            document.getElementById("editSiswaModal")
          ).hide();
          // Tampilkan alert sukses
          showCustomAlert("success", "Data Siswa Berhasil Diperbarui!");
        });

        // Logika Hapus Siswa
        $("#siswaTable tbody").on("click", ".btn-delete", function () {
          const siswaId = $(this).data("id");
          const rowElement = $(this).closest("tr");

          // Tampilkan modal konfirmasi hapus
          showDeleteConfirmationModal(siswaId, rowElement);
        });

        // --- Custom Alert dan Modal Konfirmasi ---

        function showCustomAlert(type, message) {
          const alertHtml = `
                    <div class="alert alert-${type} alert-dismissible fade show fixed-top mt-3 mx-auto" role="alert" style="max-width: 400px; z-index: 1060;">
                        ${message}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                `;
          $("body").append(alertHtml);
          // Auto hide after 3 seconds
          setTimeout(() => $(".alert").alert("close"), 3000);
        }

        function showDeleteConfirmationModal(siswaId, rowElement) {
          const modalId = "deleteConfirmModal";
          let modal = bootstrap.Modal.getInstance(
            document.getElementById(modalId)
          );

          // Jika modal belum ada, buat (hanya sekali)
          if (!modal) {
            const modalHtml = `
                        <div class="modal fade" id="${modalId}" tabindex="-1" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content rounded-4 border-danger border-2">
                                    <div class="modal-header bg-danger text-white">
                                        <h5 class="modal-title"><i class="fas fa-exclamation-triangle me-2"></i> Konfirmasi Hapus Data</h5>
                                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        Anda yakin ingin menghapus data siswa ini? Aksi ini tidak dapat dibatalkan.
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary rounded-3" data-bs-dismiss="modal">Batal</button>
                                        <button type="button" class="btn btn-danger rounded-3" id="confirmDeleteButton">Hapus Permanen</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
            $("body").append(modalHtml);
            modal = new bootstrap.Modal(document.getElementById(modalId));
          }

          modal.show();

          // Detach previous event handler and attach new one to prevent multiple calls
          $("#confirmDeleteButton")
            .off("click")
            .on("click", function () {
              // Hapus data dari array dummy
              const initialLength = siswaData.length;
              siswaData = siswaData.filter((s) => s.id !== siswaId);

              if (siswaData.length < initialLength) {
                // Hapus baris dari DataTables
                table.row(rowElement).remove().draw(false);
                modal.hide();
                showCustomAlert("danger", "Data Siswa Berhasil Dihapus.");
              } else {
                modal.hide();
                showCustomAlert("warning", "Gagal menghapus data.");
              }
            });
        }
      });
    </script>
  </body>
</html>
